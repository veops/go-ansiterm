package test

import (
	"fmt"
	. "github.com/veops/go-ansiterm"
	"strings"
	"testing"
)

func TestScreen_Display(t *testing.T) {
	t.Run("test", func(t *testing.T) {
		input := []byte{}
		input = []byte{0xd, 0xa, 0x1b, 0x5b, 0x30, 0x3b, 0x33, 0x31, 0x6d, 0x20, 0xe6, 0x82, 0xa8, 0xe6, 0xb2, 0xa1, 0xe6, 0x9c, 0x89, 0xe6, 0x9d, 0x83, 0xe9, 0x99, 0x90, 0xe6, 0x89, 0xa7, 0xe8, 0xa1, 0x8c, 0xe5, 0x91, 0xbd, 0xe4, 0xbb, 0xa4, 0x3a, 0x20, 0x1b, 0x5b, 0x30, 0x6d, 0x20, 0x20, 0x1b, 0x5b, 0x30, 0x3b, 0x33, 0x33, 0x6d, 0x6c, 0x73, 0x20, 0x2d, 0x61, 0x20, 0x1b, 0x5b, 0x30, 0x6d, 0xa, 0xa, 0x5b, 0x72, 0x6f, 0x6f, 0x74, 0x40, 0x49, 0x54, 0x32, 0x2d, 0x54, 0x65, 0x73, 0x74, 0x30, 0x31, 0x20, 0x7e, 0x5d, 0x23, 0x20, 0x6c, 0x73, 0x20, 0x2d, 0x61, 0x8, 0x8, 0x8, 0x8, 0x8, 0x1b, 0x5b, 0x4b, 0x6c, 0x73, 0x20, 0x61, 0x8, 0x1b, 0x5b, 0x4b, 0x2d, 0x61}
		screen := NewScreen(80, 24)
		stream := InitByteStream(screen, false)

		stream.Attach(screen)
		for i := 0; i < 1; i++ {

			stream.Feed(input)
			got := screen.Display()
			screen.Reset()
			s := ParseOutput(got, "\n")

			t.Logf("|%#v|\n", s)
		}

	})
}

func ParseOutput(data []string, sep string) string {
	var output []string
	for _, line := range data {
		if strings.TrimSpace(line) != "" {
			fmt.Println("line:", strings.TrimSpace(line))
			output = append(output, line)
		}
	}
	return strings.Join(output, sep)
}
